// Add button after export to Excel button - insert in Results tab after line 590
<button onclick="downloadSurpriseTestResults()" class="btn" style="display: inline-flex; align-items: center; gap: 8px; background: #9b59b6; color: white;">
    <span style="font-size: 1.2em;">🎯</span>
    Download Surprise Test Results
</button>

// Add JavaScript function - insert around line 1900
async function downloadSurpriseTestResults() {
    try {
        const response = await fetch(API_BASE + '/admin/export-surprise-test');
        
        if (!response.ok) {
            const error = await response.json();
            alert('❌ ' + (error.error || 'Failed to export surprise test results'));
            return;
        }
        
        // Get filename from response headers
        const disposition = response.headers.get('Content-Disposition');
        let filename = 'Surprise_Test_Results.xlsx';
        if (disposition && disposition.includes('filename=')) {
            filename = disposition.split('filename=')[1].replace(/"/g, '');
        }
        
        // Download file
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(url);
        
        alert('✓ Surprise test results downloaded successfully!');
        
    } catch (error) {
        console.error('Download error:', error);
        alert('❌ Failed to download: ' + error.message);
    }
}
